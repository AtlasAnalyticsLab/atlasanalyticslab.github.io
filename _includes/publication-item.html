{%- comment -%}
  Publication card partial:
  - Displays a thumbnail column (defaults to the lab logo when no list_image is provided).
  - Renders venue metadata and resource links pulled from _data/publications.yml.
{%- endcomment -%}
{% assign entry = include.entry | default: empty %}
{% assign include_year = include.include_year | default: false %}
{% assign item_id = entry.id | default: entry.title | slugify %}

{% assign list_image = entry.list_image %}
{% if list_image %}
  {% unless list_image contains '/' %}
    {% assign list_image = 'images/pubpic/' | append: list_image %}
  {% endunless %}
{% else %}
  {% assign list_image = 'images/logopic/group_logo_medium.png' %}
{% endif %}

{% assign meta_parts = '' | split: '' %}
{% assign venue = entry.journal | default: entry.booktitle | default: entry.publisher | default: entry.school %}
{% if venue %}
  {% assign meta_parts = meta_parts | push: venue %}
{% endif %}
{% if entry.series %}
  {% assign meta_parts = meta_parts | push: entry.series %}
{% endif %}
{% assign volume_part = '' %}
{% if entry.volume %}
  {% assign volume_part = 'Vol. ' | append: entry.volume %}
{% endif %}
{% if entry.number %}
  {% assign number_part = 'No. ' | append: entry.number %}
  {% if volume_part %}
    {% assign volume_part = volume_part | append: ', ' | append: number_part %}
  {% else %}
    {% assign volume_part = number_part %}
  {% endif %}
{% endif %}
{% if volume_part %}
  {% assign meta_parts = meta_parts | push: volume_part %}
{% endif %}
{% if entry.pages %}
  {% assign meta_parts = meta_parts | push: 'pp. ' | append: entry.pages %}
{% endif %}
{% if entry.month %}
  {% assign meta_parts = meta_parts | push: entry.month %}
{% endif %}
{% if include_year and entry.year %}
  {% assign meta_parts = meta_parts | push: entry.year %}
{% endif %}
{% capture meta_string %}{{ meta_parts | join: ' Â· ' }}{% endcapture %}
{% assign meta_string = meta_string | strip %}

<li class="publication-item" id="{{ item_id }}">
  <div class="publication-card publication-card--with-media">
    <div class="publication-card__media">
      <img src="{{ list_image | relative_url }}" alt="Illustration for {{ entry.title | escape }}" loading="lazy">
    </div>
    <div class="publication-card__body">
      <div class="publication-title">{{ entry.title }}</div>
      {% if entry.authors %}
        <div class="publication-authors">{{ entry.authors }}</div>
      {% endif %}
      {% if meta_string != '' %}
        <div class="publication-meta">{{ meta_string }}</div>
      {% endif %}
      {% if entry.note %}
        <div class="publication-note">{{ entry.note }}</div>
      {% endif %}
      <div class="publication-links">
        {% assign link_count = 0 %}
        {%- comment -%}
          Publication links in consistent order:
          1. Link (project/paper website)
          2. arXiv
          3. GitHub
          4. DOI
          5. PDF
          6. Video
          7. Poster
        {%- endcomment -%}
        {% if entry.url %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="{{ entry.url }}">Link</a>
        {% endif %}
        {% if entry.arxiv %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="https://arxiv.org/abs/{{ entry.arxiv }}">arXiv</a>
        {% endif %}
        {% if entry.github %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="{{ entry.github }}">GitHub</a>
        {% endif %}
        {% if entry.doi %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="https://doi.org/{{ entry.doi }}">DOI</a>
        {% endif %}
        {% if entry.video %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="{{ entry.video }}">Video</a>
        {% endif %}
        {% if entry.poster %}
          {% assign link_count = link_count | plus: 1 %}
          <a class="pub-link" href="{{ entry.poster }}">Poster</a>
        {% endif %}
        {% if link_count == 0 %}
          <span class="pub-link placeholder">Links coming soon</span>
        {% endif %}
      </div>
    </div>
  </div>
</li>
